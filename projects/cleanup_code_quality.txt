Code Quality Cleanup Backlog
============================

Items a Rust expert would flag, roughly ordered by impact:

1. [DONE] GVN pass parameter threading -> GvnState struct
   - gvn_dfs had 14 params, process_block had 10 params
   - Fixed by introducing GvnState struct with save_scope/restore_scope

2. [DONE] Functions with 10-20+ parameters
   - parse_declaration_rest: 22 params -> DeclContext struct (DeclAttributes + alignment info)
   - parse_function_def: 11 params -> accepts DeclAttributes directly
   - resolve_type_flags: 16 boolean params -> TypeSpecFlags struct
   - collect_trailing_specifiers: 10 params -> TypeSpecFlags struct
   - gvn_dfs: DONE (was 14 params, now GvnState struct)

3. Visibility: 1309 pub items vs 16 pub(crate) (large effort)
   - Nearly every struct field, method, and type is unrestricted pub
   - Should audit and restrict to pub(crate) or pub(super) where possible
   - Highest impact files: ir/ir.rs (133 pub), parser/ast.rs (117 pub),
     common/types.rs (98 pub), backend/state.rs (62 pub)

4. [PARTIAL] String allocations from literals (medium effort)
   - Was 420 .to_string() calls, now 334 (86 eliminated)
   - Register name functions (reg_to_32, reg_to_16, reg_to_64, reg_to_8l,
     reg_to_8h) in x86 and i686 backends now return Cow<'_, str> instead
     of String, avoiding heap allocations for known register names.
     format_x86_reg, format_i686_reg, src_reg_for_type, dest_reg_for_type
     also updated. x86_normalize_reg_to_64bit returns Cow<'static, str>.
   - Remaining: builtin_macros.rs (41 calls), preprocessor includes (33),
     other frontend/IR files (~260 remaining calls)

5. format! in codegen hot paths, zero write! usage (medium effort)
   - 320 format! calls across the codebase, 0 write!/writeln!
   - ARM codegen loops allocate 2 Strings per iteration for register names
   - Could use static lookup tables for register names

6. Deep nesting (16 levels) in global_init.rs (small-medium effort)
   - Nested match/if-let chains at src/ir/lowering/global_init.rs:490-522
   - Extract compound literal handling into helper functions

7. Lowerer split across 37 files (large effort, low priority)
   - Valid Rust pattern but extreme; makes API surface hard to understand
   - Consider grouping related impl blocks or adding a module-level doc
